From f8699ecbef6a678beb41456baf40e2ddf37a97d0 Mon Sep 17 00:00:00 2001
From: Derek <derek@mac.mynetworksettings.com>
Date: Fri, 26 Dec 2025 09:19:59 -0500
Subject: [PATCH 1/3] build: add optional static library target

---
 CMakeLists.txt | 20 ++++++++++++++++++--
 1 file changed, 18 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 5d39a5c..9ec1072 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -61,8 +61,20 @@ if (APPLE)
   endif()
 endif()
 
+option(SIGNALBACKUP_BUILD_EXECUTABLE "Build signalbackup-tools CLI" OFF)
+
 file(GLOB SOURCES CONFIGURE_DEPENDS */*.cc */*.h *.cc *.h)
-add_executable(signalbackup-tools ${SOURCES})
+set(SBT_SOURCES ${SOURCES})
+list(FILTER SBT_SOURCES EXCLUDE REGEX ".*/main\\.cc$")
+list(FILTER SBT_SOURCES EXCLUDE REGEX ".*/main\\.h$")
+
+add_library(signalbackup_tools_static STATIC ${SBT_SOURCES} gt_bridge/gt_bridge.cc)
+target_include_directories(signalbackup_tools_static PUBLIC ${CMAKE_CURRENT_SOURCE_DIR})
+install(TARGETS signalbackup_tools_static ARCHIVE DESTINATION lib)
+
+if (SIGNALBACKUP_BUILD_EXECUTABLE)
+  add_executable(signalbackup-tools ${SOURCES})
+endif()
 
 if (WIN32)
   target_compile_definitions(signalbackup-tools PRIVATE WIN32_LEAN_AND_MEAN NOMINMAX)
@@ -71,4 +83,8 @@ if (WIN32)
   target_compile_options(signalbackup-tools PUBLIC /utf-8 /wd4244 /wd4267 /wd4996)
 endif()
 
-target_link_libraries(signalbackup-tools PRIVATE OpenSSL::Crypto PRIVATE SQLite::SQLite3 ${SECLIB} ${CFLIB} ${DBUS_LIBS_ABSOLUTE})
+target_link_libraries(signalbackup_tools_static PRIVATE OpenSSL::Crypto PRIVATE SQLite::SQLite3 ${SECLIB} ${CFLIB} ${DBUS_LIBS_ABSOLUTE})
+
+if (SIGNALBACKUP_BUILD_EXECUTABLE)
+  target_link_libraries(signalbackup-tools PRIVATE OpenSSL::Crypto PRIVATE SQLite::SQLite3 ${SECLIB} ${CFLIB} ${DBUS_LIBS_ABSOLUTE})
+endif()
-- 
2.39.5 (Apple Git-154)

